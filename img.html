<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Happy Store</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f5f5f5;
    padding:20px;
}
/* CONTENEDORES */
.login, .form-container{
    max-width:420px;
    margin:50px auto;
    background:#fff;
    padding:20px;
    border-radius:12px;
    box-shadow:0 4px 10px rgba(0,0,0,0.1);
}
.form-container{
    position:relative;
}
/* INPUTS */
input, select, textarea{
    width:100%;
    padding:10px;
    margin:10px 0;
    border-radius:6px;
    border:1px solid #ccc;
    box-sizing:border-box;
}
/* INPUT PASSWORD CON OJO */
.password-box{
    position:relative;
}
.password-box input{
    padding-right:45px;
}
/* ICONO OJO */
.eye-btn{
    position:absolute;
    right:5px;
    top:50%;
    transform:translateY(-50%);
    background:transparent !important;
    border:none;
    cursor:pointer;
    width:35px;
    height:35px;
    display:flex;
    align-items:center;
    justify-content:center;
}
/* BOTONES */
button{
    width:100%;
    padding:12px;
    border:none;
    border-radius:6px;
    background:#FF002F;
    color:white;
    cursor:pointer;
    font-weight:bold;
}
button:hover{
    background:#cc0026;
}
h2{
    text-align:center;
}
.preview{
    width:100%;
    margin-bottom:10px;
    border-radius:8px;
    display:block;
}
/* BOTON X */
.logout-btn{
    position:absolute;
    top:8px;
    right:8px;
    background:#FF002F;
    color:white;
    border:none;
    width:34px;
    height:34px;
    border-radius:6px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:18px;
    font-weight:bold;
    cursor:pointer;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div class="login" id="loginBox">
<h2>Admin Login</h2>
<input type="text" id="user" placeholder="Usuario">
<div class="password-box">
<input type="password" id="pass" placeholder="Contraseña">
<button type="button" id="togglePass" class="eye-btn">
<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="#555" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
<path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
<circle cx="12" cy="12" r="3"/>
</svg>
</button>
</div>
<button onclick="login()">Entrar</button>
</div>

<!-- PANEL -->
<div class="form-container" id="adminForm" style="display:none;">
<button class="logout-btn" onclick="logout()">✕</button>
<h2>Agregar Producto</h2>
<form id="formProducto">
<input type="text" id="nombre" placeholder="Nombre" required>
<textarea id="descripcion" placeholder="Descripción"></textarea>
<input type="number" id="precio" placeholder="Precio">
<input type="number" id="valoracion" placeholder="Valoración (0-10)" min="0" max="10">
<select id="estado">
<option value="Disponible">Disponible</option>
<option value="Reservado">Reservado</option>
<option value="Vendido">Vendido</option>
</select>
<select id="visibilidad">
<option value="publico">Público</option>
<option value="privado">Privado</option>
</select>

<!-- ARCHIVOS IMG -->
<input type="file" id="file1" onchange="uploadImg('file1','img1')">
<img id="img1" class="preview">
<input type="file" id="file2" onchange="uploadImg('file2','img2')">
<img id="img2" class="preview">
<input type="file" id="file3" onchange="uploadImg('file3','img3')">
<img id="img3" class="preview">
<input type="file" id="file4" onchange="uploadImg('file4','img4')">
<img id="img4" class="preview">
<input type="file" id="file5" onchange="uploadImg('file5','img5')">
<img id="img5" class="preview">

<button type="button" onclick="agregarProducto()" id="btnGuardar">
Agregar Producto
</button>
</form>
</div>

<script>
// ---------------- LOGIN ----------------
function login(){
    const user = document.getElementById('user').value;
    const pass = document.getElementById('pass').value;
    if(user === "admin" && pass === "1234"){
        localStorage.setItem("adminLogin","true");
        mostrarPanel();
    }else{
        alert("Usuario incorrecto");
    }
}

function mostrarPanel(){
    document.getElementById('loginBox').style.display='none';
    document.getElementById('adminForm').style.display='block';
}

window.onload = function(){
    if(localStorage.getItem("adminLogin")==="true"){
        mostrarPanel();
    }
}

function logout(){
    localStorage.removeItem("adminLogin");
    location.reload();
}

// ---------------- OJO PASSWORD ----------------
const passInput = document.getElementById("pass");
const toggleBtn = document.getElementById("togglePass");
toggleBtn.addEventListener("mousedown", () => { passInput.type = "text"; });
toggleBtn.addEventListener("mouseup", () => { passInput.type = "password"; });
toggleBtn.addEventListener("mouseleave", () => { passInput.type = "password"; });
toggleBtn.addEventListener("touchstart", () => { passInput.type = "text"; });
toggleBtn.addEventListener("touchend", () => { passInput.type = "password"; });

// ---------------- PREVIEW Y IMG UPLOAD ----------------
const IMGBB_KEY = "75e1c4c1e2ecce08add2221e38311f82";

async function uploadImg(fileInputId, previewId){
    const fileInput = document.getElementById(fileInputId);
    const file = fileInput.files[0];
    if(!file) return;
    const formData = new FormData();
    formData.append("image", file);
    try{
        const res = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_KEY}`, {
            method:"POST",
            body: formData
        });
        const data = await res.json();
        if(data.success){
            document.getElementById(previewId).src = data.data.url;
            document.getElementById(previewId).dataset.url = data.data.url;
        } else {
            alert("Error al subir imagen");
        }
    }catch(err){
        alert("Error de conexión con ImgBB");
        console.error(err);
    }
}

// ---------------- AGREGAR PRODUCTO ----------------
function agregarProducto(){
    const btn = document.getElementById("btnGuardar");
    btn.innerText="Guardando...";
    btn.style.background="#00b894";

    // ---------------- TOMAR VALORES ----------------
    const nombre = document.getElementById('nombre').value.trim();
    const precio = parseFloat(document.getElementById('precio').value);
    const valoracion = parseFloat(document.getElementById('valoracion').value);

    // ---------------- VALIDACIÓN BÁSICA ----------------
    if(!nombre){
        alert("El nombre del producto es obligatorio");
        btn.innerText="Agregar Producto";
        btn.style.background="#FF002F";
        return;
    }

    if(isNaN(precio) || precio < 0){
        alert("Ingresa un precio válido mayor o igual a 0");
        btn.innerText="Agregar Producto";
        btn.style.background="#FF002F";
        return;
    }

    if(isNaN(valoracion) || valoracion < 0 || valoracion > 10){
        alert("La valoración debe estar entre 0 y 10");
        btn.innerText="Agregar Producto";
        btn.style.background="#FF002F";
        return;
    }

    // ---------------- CREAR OBJETO PRODUCTO ----------------
    const producto = {
        nombre,
        descripcion: document.getElementById('descripcion').value.trim(),
        precio,
        valoracion,
        estado: document.getElementById('estado').value,
        visibilidad: document.getElementById('visibilidad').value,
        img1: document.getElementById('img1').dataset.url || "",
        img2: document.getElementById('img2').dataset.url || "",
        img3: document.getElementById('img3').dataset.url || "",
        img4: document.getElementById('img4').dataset.url || "",
        img5: document.getElementById('img5').dataset.url || ""
    };

    // ---------------- ENVIAR DATOS ----------------
    fetch("https://script.google.com/macros/s/AKfycbz5jmczBym2G_VaClZiNriAqYTpF-6qDSnRzWhRaSNHtGlDHECy03PhJT0polNG00endw/exec",{
        method:"POST",
        body: JSON.stringify({action:"agregar", producto})
    })
    .then(res=>res.json())
    .then(data=>{
        btn.innerText="Agregar Producto";
        btn.style.background="#FF002F";
        if(data.success){
            alert("Producto agregado correctamente");
            document.getElementById("formProducto").reset();
            document.querySelectorAll(".preview").forEach(img=>{
                img.src="";
                img.dataset.url="";
            });
        }else{
            alert("Error al guardar");
        }
    })
    .catch(()=>{
        btn.innerText="Agregar Producto";
        btn.style.background="#FF002F";
        alert("Error de conexión");
    });
}
</script>
</body>
</html>
